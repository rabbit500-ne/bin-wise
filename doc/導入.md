**Docker Compose**を使用せず、**Dockerのみ**で**PostgreSQL**と**Elasticsearch**を起動する方法を説明します。それぞれのDockerfileを使って手動でビルドとコンテナ起動を行います。

---

# 📄 **Dockerfile の準備**

### 1. **PostgreSQL用 Dockerfile**

ファイル名: `Dockerfile.postgres`

```dockerfile
FROM postgres:15

# 環境変数で初期設定
ENV POSTGRES_DB=garbage_db
ENV POSTGRES_USER=admin
ENV POSTGRES_PASSWORD=admin

# 初期データベーススクリプトをコピー
COPY init.sql /docker-entrypoint-initdb.d/
```

### 2. **Elasticsearch用 Dockerfile**

ファイル名: `Dockerfile.elasticsearch`

```dockerfile
FROM docker.elastic.co/elasticsearch/elasticsearch:8.11.1

# 環境変数設定
ENV discovery.type=single-node
```

---

# 📄 **初期データベーススクリプト**

ファイル名: `init.sql`

```sql
CREATE TABLE municipalities (
    municipality_id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE categories (
    category_id SERIAL PRIMARY KEY,
    category_name VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE item_types (
    type_id SERIAL PRIMARY KEY,
    type_name VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE municipality_itemtype_category_map (
    municipality_id INTEGER REFERENCES municipalities(municipality_id),
    type_id INTEGER REFERENCES item_types(type_id),
    category_id INTEGER REFERENCES categories(category_id),
    PRIMARY KEY (municipality_id, type_id)
);

CREATE TABLE municipality_category_instructions (
    instruction_id SERIAL PRIMARY KEY,
    municipality_id INTEGER REFERENCES municipalities(municipality_id),
    category_id INTEGER REFERENCES categories(category_id),
    instruction_text TEXT NOT NULL
);
```

---

# 🚀 **コンテナのビルドと起動手順**

## 1. **PostgreSQL コンテナのビルドと起動**

### 1.1 Dockerイメージのビルド

```bash
docker build -t bw_postgres -f Dockerfile.postgres .
```

### 1.2 コンテナの起動

```cmd
docker run -d `
  --name bw_postgres `
  -p 5432:5432 `
  -v pg_data:/var/lib/postgresql/data `
  -e POSTGRES_DB=garbage_db `
  -e POSTGRES_USER=admin `
  -e POSTGRES_PASSWORD=admin `
  img_bw_postgres
```

### 1.3 確認

```bash
docker ps
```

---

## 2. **Elasticsearch コンテナのビルドと起動**

### 2.1 Dockerイメージのビルド

```bash
docker build -t bw_elasticsearch -f Dockerfile.elasticsearch .
```

### 2.2 コンテナの起動

```cmd
docker run -d `
  --name elasticsearch `
  -p 9200:9200 `
  -p 9300:9300 `
  -e "discovery.type=single-node" `
  img_bw_elasticsearch
```

### 2.3 確認

```bash
docker ps
```

Elasticsearchが正しく動作しているか確認するには、以下のURLにアクセスします。

```
http://localhost:9200
```

---

# 🗑️ **コンテナの停止と削除**

### PostgreSQLコンテナの停止と削除

```bash
docker stop postgres_db
docker rm postgres_db
```

### Elasticsearchコンテナの停止と削除

```bash
docker stop elasticsearch
docker rm elasticsearch
```

### イメージの削除

```bash
docker rmi my_postgres my_elasticsearch
```

---

# 📝 **補足**

- **データ永続化**:  
  PostgreSQLのデータはボリューム `pg_data` に永続化されます。削除する場合は次のコマンドで削除できます。  
  ```bash
  docker volume rm pg_data
  ```

- **セキュリティ**:  
  Elasticsearchはセキュリティを無効化しています。本番環境では認証や適切なアクセス制限を設定してください。

これでDockerのみを使用して、PostgreSQLとElasticsearchが動作する環境を構築できます！