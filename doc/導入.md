**Docker Compose**ã‚’ä½¿ç”¨ã›ãšã€**Dockerã®ã¿**ã§**PostgreSQL**ã¨**Elasticsearch**ã‚’èµ·å‹•ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚ãã‚Œãã‚Œã®Dockerfileã‚’ä½¿ã£ã¦æ‰‹å‹•ã§ãƒ“ãƒ«ãƒ‰ã¨ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã‚’è¡Œã„ã¾ã™ã€‚

---

# ğŸ“„ **Dockerfile ã®æº–å‚™**

### 1. **PostgreSQLç”¨ Dockerfile**

ãƒ•ã‚¡ã‚¤ãƒ«å: `Dockerfile.postgres`

```dockerfile
FROM postgres:15

# ç’°å¢ƒå¤‰æ•°ã§åˆæœŸè¨­å®š
ENV POSTGRES_DB=garbage_db
ENV POSTGRES_USER=admin
ENV POSTGRES_PASSWORD=admin

# åˆæœŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼
COPY init.sql /docker-entrypoint-initdb.d/
```

### 2. **Elasticsearchç”¨ Dockerfile**

ãƒ•ã‚¡ã‚¤ãƒ«å: `Dockerfile.elasticsearch`

```dockerfile
FROM docker.elastic.co/elasticsearch/elasticsearch:8.11.1

# ç’°å¢ƒå¤‰æ•°è¨­å®š
ENV discovery.type=single-node
```

---

# ğŸ“„ **åˆæœŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**

ãƒ•ã‚¡ã‚¤ãƒ«å: `init.sql`

```sql
CREATE TABLE municipalities (
    municipality_id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE categories (
    category_id SERIAL PRIMARY KEY,
    category_name VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE item_types (
    type_id SERIAL PRIMARY KEY,
    type_name VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE municipality_itemtype_category_map (
    municipality_id INTEGER REFERENCES municipalities(municipality_id),
    type_id INTEGER REFERENCES item_types(type_id),
    category_id INTEGER REFERENCES categories(category_id),
    PRIMARY KEY (municipality_id, type_id)
);

CREATE TABLE municipality_category_instructions (
    instruction_id SERIAL PRIMARY KEY,
    municipality_id INTEGER REFERENCES municipalities(municipality_id),
    category_id INTEGER REFERENCES categories(category_id),
    instruction_text TEXT NOT NULL
);
```

---

# ğŸš€ **ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ“ãƒ«ãƒ‰ã¨èµ·å‹•æ‰‹é †**

## 1. **PostgreSQL ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ“ãƒ«ãƒ‰ã¨èµ·å‹•**

### 1.1 Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰

```bash
docker build -t bw_postgres -f Dockerfile.postgres .
```

### 1.2 ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•

```cmd
docker run -d `
  --name bw_postgres `
  -p 5432:5432 `
  -v pg_data:/var/lib/postgresql/data `
  -e POSTGRES_DB=garbage_db `
  -e POSTGRES_USER=admin `
  -e POSTGRES_PASSWORD=admin `
  img_bw_postgres
```

### 1.3 ç¢ºèª

```bash
docker ps
```

---

## 2. **Elasticsearch ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ“ãƒ«ãƒ‰ã¨èµ·å‹•**

### 2.1 Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰

```bash
docker build -t bw_elasticsearch -f Dockerfile.elasticsearch .
```

### 2.2 ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•

```cmd
docker run -d `
  --name elasticsearch `
  -p 9200:9200 `
  -p 9300:9300 `
  -e "discovery.type=single-node" `
  img_bw_elasticsearch
```

### 2.3 ç¢ºèª

```bash
docker ps
```

ElasticsearchãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

```
http://localhost:9200
```

---

# ğŸ—‘ï¸ **ã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢ã¨å‰Šé™¤**

### PostgreSQLã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢ã¨å‰Šé™¤

```bash
docker stop postgres_db
docker rm postgres_db
```

### Elasticsearchã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢ã¨å‰Šé™¤

```bash
docker stop elasticsearch
docker rm elasticsearch
```

### ã‚¤ãƒ¡ãƒ¼ã‚¸ã®å‰Šé™¤

```bash
docker rmi my_postgres my_elasticsearch
```

---

# ğŸ“ **è£œè¶³**

- **ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–**:  
  PostgreSQLã®ãƒ‡ãƒ¼ã‚¿ã¯ãƒœãƒªãƒ¥ãƒ¼ãƒ  `pg_data` ã«æ°¸ç¶šåŒ–ã•ã‚Œã¾ã™ã€‚å‰Šé™¤ã™ã‚‹å ´åˆã¯æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§å‰Šé™¤ã§ãã¾ã™ã€‚  
  ```bash
  docker volume rm pg_data
  ```

- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**:  
  Elasticsearchã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ç„¡åŠ¹åŒ–ã—ã¦ã„ã¾ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯èªè¨¼ã‚„é©åˆ‡ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

ã“ã‚Œã§Dockerã®ã¿ã‚’ä½¿ç”¨ã—ã¦ã€PostgreSQLã¨ElasticsearchãŒå‹•ä½œã™ã‚‹ç’°å¢ƒã‚’æ§‹ç¯‰ã§ãã¾ã™ï¼