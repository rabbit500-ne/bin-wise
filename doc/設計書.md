# ğŸ“„ **SQL ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©æ›¸**

## 1. **municipalitiesï¼ˆè‡ªæ²»ä½“ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**

```sql
CREATE TABLE municipalities (
    municipality_id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE
);
```

### èª¬æ˜:
- **municipality_id**: è‡ªæ²»ä½“ID (ä¸»ã‚­ãƒ¼)
- **name**: è‡ªæ²»ä½“å (ãƒ¦ãƒ‹ãƒ¼ã‚¯)

---

## 2. **categoriesï¼ˆã‚«ãƒ†ã‚´ãƒªãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**

```sql
CREATE TABLE categories (
    category_id SERIAL PRIMARY KEY,
    category_name VARCHAR(255) NOT NULL UNIQUE
);
```

### èª¬æ˜:
- **category_id**: ã‚«ãƒ†ã‚´ãƒªID (ä¸»ã‚­ãƒ¼)
- **category_name**: ã‚«ãƒ†ã‚´ãƒªå

---

## 3. **item_typesï¼ˆã”ã¿å“ç›®ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**

```sql
CREATE TABLE item_types (
    type_id SERIAL PRIMARY KEY,
    type_name VARCHAR(255) NOT NULL UNIQUE
);
```

### èª¬æ˜:
- **type_id**: ã”ã¿å“ç›®ID (ä¸»ã‚­ãƒ¼)
- **type_name**: ã”ã¿å“ç›®å

---

## 4. **municipality_itemtype_category_mapï¼ˆè‡ªæ²»ä½“ã”ã¿å“ç›®ã‚«ãƒ†ã‚´ãƒªãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**

```sql
CREATE TABLE municipality_itemtype_category_map (
    municipality_id INTEGER REFERENCES municipalities(municipality_id),
    type_id INTEGER REFERENCES item_types(type_id),
    category_id INTEGER REFERENCES categories(category_id),
    PRIMARY KEY (municipality_id, type_id)
);
```

### èª¬æ˜:
- **municipality_id**: è‡ªæ²»ä½“ID (å¤–éƒ¨ã‚­ãƒ¼)
- **type_id**: ã”ã¿å“ç›®ID (å¤–éƒ¨ã‚­ãƒ¼)
- **category_id**: ã‚«ãƒ†ã‚´ãƒªID (å¤–éƒ¨ã‚­ãƒ¼)
- **PRIMARY KEY**: è¤‡åˆã‚­ãƒ¼ã§`municipality_id`ã¨`type_id`ã‚’çµ„ã¿åˆã‚ã›ã¦ä¸€æ„ã¨ã™ã‚‹

---

## 5. **municipality_category_instructionsï¼ˆæ¨ã¦æ–¹æƒ…å ±ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**

```sql
CREATE TABLE municipality_category_instructions (
    instruction_id SERIAL PRIMARY KEY,
    municipality_id INTEGER REFERENCES municipalities(municipality_id),
    category_id INTEGER REFERENCES categories(category_id),
    instruction_text TEXT NOT NULL
);
```

### èª¬æ˜:
- **instruction_id**: æ¨ã¦æ–¹æƒ…å ±ID (ä¸»ã‚­ãƒ¼)
- **municipality_id**: è‡ªæ²»ä½“ID (å¤–éƒ¨ã‚­ãƒ¼)
- **category_id**: ã‚«ãƒ†ã‚´ãƒªID (å¤–éƒ¨ã‚­ãƒ¼)
- **instruction_text**: æ¨ã¦æ–¹ã®è©³ç´°ãªèª¬æ˜

---

# ğŸ“„ **Elasticsearch JSON ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©æ›¸**

## 1. **ç‰©å“åã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ (objects ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹)**

### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å: `objects`

```json
PUT objects
{
  "mappings": {
    "properties": {
      "object_id": {
        "type": "keyword"
      },
      "type_id": {
        "type": "keyword"
      },
      "object_name": {
        "type": "text",
        "analyzer": "standard"
      },
      "embedding": {
        "type": "dense_vector",
        "dims": 768
      }
    }
  }
}
```

### èª¬æ˜:
- **object_id**: ç‰©å“ID (ä¸€æ„è­˜åˆ¥ç”¨ã€`keyword`å‹)
- **type_id**: ã”ã¿å“ç›®ID (RDBã®`item_types`ã«ç´ã¥ãIDã€`keyword`å‹)
- **object_name**: ç‰©å“å (è‡ªç”±æ¤œç´¢ãŒå¿…è¦ãªãŸã‚`text`å‹)
- **embedding**: ãƒ™ã‚¯ãƒˆãƒ«è¡¨ç¾ã§ã®é¡ä¼¼æ¤œç´¢ç”¨ (`dense_vector`å‹ã€æ¬¡å…ƒæ•°ã¯ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã«åˆã‚ã›ã‚‹ã€‚ä¾‹: 768æ¬¡å…ƒ)

---

## 2. **ç‰©å“æ¤œç´¢æ™‚ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŠ•å…¥**

```json
POST objects/_doc/1
{
  "object_id": "1",
  "type_id": "1",
  "object_name": "ãƒ†ã‚£ãƒƒã‚·ãƒ¥",
  "embedding": [0.12, 0.34, 0.56, ..., 0.78]
}

POST objects/_doc/2
{
  "object_id": "2",
  "type_id": "1",
  "object_name": "ãƒˆã‚¤ãƒ¬ãƒƒãƒˆãƒšãƒ¼ãƒ‘ãƒ¼",
  "embedding": [0.23, 0.45, 0.67, ..., 0.89]
}
```

---

# ğŸ“ **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨Elasticsearchã®é€£æºãƒã‚¤ãƒ³ãƒˆ**

1. **RDBã«ç™»éŒ²ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿**:
   - è‡ªæ²»ä½“ (`municipalities`)  
   - ã‚«ãƒ†ã‚´ãƒª (`categories`)  
   - ã”ã¿å“ç›® (`item_types`)  
   - ãƒãƒƒãƒ”ãƒ³ã‚° (`municipality_itemtype_category_map`)  
   - æ¨ã¦æ–¹æƒ…å ± (`municipality_category_instructions`)

2. **Elasticsearchã«ç™»éŒ²ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿**:
   - ç‰©å“å (`objects`)  
   - Embeddingï¼ˆãƒ™ã‚¯ãƒˆãƒ«ï¼‰ã«ã‚ˆã‚‹é¡ä¼¼æ¤œç´¢ç”¨ã®ãƒ‡ãƒ¼ã‚¿

3. **æ¤œç´¢ã®æµã‚Œ**:
   1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰©å“åã‚’æ¤œç´¢ã™ã‚‹ã¨ã€Elasticsearchã§`object_name`ã¾ãŸã¯`embedding`ã‚’ä½¿ã£ã¦é¡ä¼¼ã™ã‚‹ç‰©å“ã‚’æ¤œç´¢ã€‚  
   2. ElasticsearchãŒè¿”ã—ãŸ`type_id`ã‚’ã‚‚ã¨ã«ã€RDBã§è©²å½“ã®è‡ªæ²»ä½“ãƒ»ã‚«ãƒ†ã‚´ãƒªæƒ…å ±ãƒ»æ¨ã¦æ–¹æƒ…å ±ã‚’å–å¾—ã€‚  
   3. çµæœã‚’çµ±åˆã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¿”ã™ã€‚

